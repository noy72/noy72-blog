---
import { getCollection, render } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { addPublishDateToArticles } from "../../lib/article.ts";

export async function getStaticPaths() {
  const articles = await getCollection("articles", ({ data }) => {
    return import.meta.env.PROD ? !data.draft : true;
  });
  const articlesWithDate = addPublishDateToArticles(articles);
  return articlesWithDate.map((article) => ({
    params: { id: article.id },
    props: article,
  }));
}

const article = Astro.props;
const { Content } = await render(article);
---

<Layout>
  <article class="max-w-screen-md mx-auto px-6 py-12">
    <header class="mb-8">
      <h1 class="text-3xl font-bold mb-3 text-gray-900">
        {article.data.title}
      </h1>
      <time
        datetime={article.publishDate.toISOString()}
        class="block text-sm text-gray-500 mb-4"
      >
        {
          article.publishDate.toLocaleDateString("ja-JP", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })
        }
      </time>
      {
        article.data.tags && article.data.tags.length > 0 && (
          <ul class="flex gap-2 flex-wrap list-none p-0">
            {article.data.tags.map((tag) => (
              <li class="text-sm">
                <a
                  href={`/tags/${tag}`}
                  class="text-gray-500 hover:text-blue-500 transition-colors"
                >
                  #{tag}
                </a>
              </li>
            ))}
          </ul>
        )
      }
    </header>
    <div class="prose prose-slate max-w-none">
      <Content />
    </div>
  </article>
</Layout>
