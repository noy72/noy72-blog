---
import { getCollection, render } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { addPublishDateToArticles } from "../../lib/article.ts";

export async function getStaticPaths() {
  const articles = await getCollection("articles", ({ data }) => {
    return import.meta.env.PROD ? !data.draft : true;
  });
  const articlesWithDate = addPublishDateToArticles(articles);
  return articlesWithDate.map((article) => ({
    params: { id: article.id },
    props: article,
  }));
}

const article = Astro.props;
const { Content } = await render(article);
---

<Layout>
  <article class="container-main">
    <header class="mb-8">
      <h1 class="article-header-title">
        {article.data.title}
      </h1>
      <time
        datetime={article.publishDate.toISOString()}
        class="meta-date-header"
      >
        {
          article.publishDate.toLocaleDateString("ja-JP", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })
        }
      </time>
      {
        article.data.tags && article.data.tags.length > 0 && (
          <ul class="tag-list">
            {article.data.tags.map((tag) => (
              <li class="tag-list-item">
                <a href={`/tags/${tag}`} class="link-tag">
                  #{tag}
                </a>
              </li>
            ))}
          </ul>
        )
      }
    </header>
    <div class="prose prose-slate max-w-none">
      <Content />
    </div>
  </article>
</Layout>
