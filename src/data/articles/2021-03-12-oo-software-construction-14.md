---
title: 『オブジェクト指向入門 第2版』の14章を読んだ
tags: ["技術書"]
thumbnail: "https://i.imgur.com/PQG6kP3m.webp"
---

第14章　継承入門

12章と13章は飛ばす．

継承はオブジェクト指向の中核となる技術である．継承によって，あるクラスが他のクラスの拡張，特殊化，組み合わせであることを表現でき，再利用性と拡張性を高めることができる．

継承の例として，多角形クラスを考える．多角形クラスには，いくつかの操作（面積や座標の計算）が実装されている．ここで，長方形クラスが必要になったとする．多角形と長方形には重複する操作がいくつか存在しており，長方形は多角形の特殊なケースだと考えられる．この場合，多角形と長方形で別々のクラスを作成するのではなく，多角形クラスの後継者として長方形クラスを作成することで，長方形クラスが多角形クラスを特殊化したものであることを表現できる．

## 継承の用語

- クラス*C*の子孫  
  *C*自身を含み，*C*を直接，間接的に継承するクラス
- クラス*C*の真の子孫  
  自身を除く子孫
- クラス*C*の祖先  
  *C*が*A*の子孫である場合の*A*
- クラス*C*の真の祖先  
  *C*が*A*の真の子孫である場合の*A*

継承を図で表すとき，

```
Polygon（多角形クラス） <- Rectangle（長方形クラス）
```

のように，後継者から親に矢印が向く．後継者はどのクラスが親なのがわかるのに対し，親はどのクラスが後継者なのかはわからないため，このような向きになっている．

## 多相性

多相性によって，実行時に，エンティティに型が異なるオブジェクトをアタッチできる．ただし，エンティティの型とオブジェクトの型が適合していなければならない．適合とは，アタッチ先*x*とアタッチ元*y*があるとき，*y*が*x*の子孫であることを示す．

```java
p: Polygon
r: Rectangle
s: String

p := s // 誤り．StringはPolygonの子孫ではない．
r := p // 誤り．PolygonはRectangleの子孫ではない．

p := r // 正しい．RectangleはPolygonの子孫である．
r := r // 正しい．RectangleはRectangleの子孫である．
```

## 動的束縛

動的束縛は，オブジェクトの動的形式によって，行う操作を変更する．例えば，以下のような*print*メソッドが実装されているとする．

```java
p: Polygon
r: Rectangle

p.print() // "Polygon"と出力
r.print() // "Rectangle"と出力
```

以下のような関数*f*には，引数に*Polygon*はもちろん，*Rectangle*も渡すことができる．*f*は*Polygon*型のインスタンスを受け取り，*print*を呼び出す．ここで呼び出されるのは*print*だが，渡された引数の型によって異なる動作をする．

```java
function f(p: Polygon) {
	p.print()
}

f(p) // "Polygon"と出力
f(r) // "Rectangle"と出力
```

## 暫定クラス

実装されていない特性（暫定特性）を持つクラスを暫定クラスという．暫定クラスのインスタンスは作れないため，暫定特性を呼び出すことはできない．

暫定クラスを継承するクラスが有効クラスになるためには，親の暫定特性を実装しなければならない．親の暫定特性は，子孫がそれを具体的な実装に置き換えることを強制する（そうでなければインスタンスが作成できない）．

## 継承の利点

### モジュールの観点

継承を用いることで，祖先には変更を加えずに，祖先を拡張した子孫を作成することができる（開放/閉鎖の原則を満たせる）．

### 型の観点

動的束縛によって，拡張性と再利用性を高めることができる．

継承は「is」の関係を表す．例えば，「すべての長方形は多角形である」といった感じ．間違った「is」の関係には，例えば，*SAN_FRANCISCO*クラスを*CITY*クラスからの継承にしてしまうこと（_SAN_FRANCISCO_ is a _CITY_）が挙げられる．より正確に言えば，継承は，「_x_ is an _A_」ではなく，「Every _B_ is an _A_」が成り立たなくてはならない．長方形の例では，「すべての長方形」が多角形に含まれているので継承関係は正しい．一方，サンフランシスコはひとつしかないので，「Every _SAN_FRANCISCO_」は誤りである．*SAN_FRANCISCO*は*CITY*クラスのインスタンスとして考えるのが正しい．

<!-- https://i.imgur.com/PQG6kP3 -->
