---
title: お名前.com から Route 53 に移行した 
tags: ["サイト更新"]
---

せっかくなのでドメインの移管作業を体験してみる。



## 移管先の選択

いくつか移管先を調べたが価格に大きな差はなかった。Route 53 は移管料金として1200円かかり、クエリ数によって月の料金が決まる。個人のブログなら大したクエリ数にならないので安く済むのでないかと思って Route 53 にした。1か月後ぐらいに実際にかかった料金を書くことにする。

ドメインの登録や移管料金のリスト：[Amazon_Route_53_Domain_Registration_Pricing_20211222](https://d32ze2gidvkk54.cloudfront.net/Amazon_Route_53_Domain_Registration_Pricing_20140731.pdf)

価格差があって面白い。





## 作業

移管の手続きは調べるといろいろ出てくるのでそこまで難しくはなさそう。

[ドメイン登録の Amazon Route 53 への移管 - Amazon Route 53](https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/domain-transfer-to-route-53.html)



### 移管の条件

ドメインを登録してから 60 日以上経っているし、`whois`で `Domain Status` が `ok` であることを確認した。ドメインをポンポン移管することはできないらしい。



### DNSサービスの移管

参考：

- [Amazon Route 53 を既存ドメインの DNS サービスとして使用する - Amazon Route 53](https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/MigratingDNS.html)

- [Route 53 を使用中のドメインの DNS サービスにする - Amazon Route 53](https://docs.aws.amazon.com/ja_jp/Route53/latest/DeveloperGuide/migrate-dns-domain-in-use.html)

ドキュメントに書いてあることをやっていくだけ。

1. コンソールからホストゾーン「noy72.com」を作成
2. 必要なさそうなのでレコードの追加はしない
3. レコード名 "noy72.com"、タイプ "NS" を編集して、TTL を 900 にする
4. DNSSEC は設定していないのでそのまま
5. 古い TTL の有効期限切れを 2 日間待つ
5. https://navi.onamae.com/domain/setting/ns から AWS で作成したレコードの値に置き換える
5. TTL を元に戻す
5. ドメインを移管する



### 情報を見る

`whois` や `dig` コマンドでドメインの登録者情報やネームサーバを調べられる。お名前.comを使っていたときは `dig` で `*.dnsv.jp` というネームサーバが確認できる。DNSサービスが移管できていれば `awsdns` というネームサーバになる。





## ドメインの移管

https://navi.onamae.com/domain/setting/whoisprotect/cancel/list から whois 代行公開を無効化する。`whois`で自分のメールアドレスなどが表示されることを確認した。

次に、お名前.comのドメイン詳細から AuthCode をコピーしておく。

あとは AWS の操作をする。Route 53 ＞ 登録済みドメイン ＞ ドメインの移管に移動する。「ドメインのオプション」で「ドメインと同じ名前の Route 53 ホストゾーンからネームサーバーをインポートする」にすると、DNSサービスの移管作業で作ったレコードが選択される。あとはポチポチするだけ。

https://console.aws.amazon.com/route53/home#DomainRequests で更新手続きの進み具合を確認できる

ここまでやるとドメイン名が解決されなくなり、noy72.com へアクセスできなくなった。こういうものなの？



## 待つ

手続きを終えてから 15 分後ぐらいにお名前.comや AWS からメールが来た。ポチポチして対応する。しばらくすると `whois` で `Registrar URL: https://registrar.amazon.com` になっていることを確認できた。ただし、noy72.comに接続はできない。

さらにしばらくすると Route 53 ＞ 登録済みドメインに noy72.com が表示された。やっぱりnoy72.comに接続できない。



## Vercel での設定

https://vercel.com<user>/<project>/settings/domains の設定ができていなかった。Route 53にレコードを追加したりネームサーバを追加したりして Valid Configuration にした。しばらくしたら接続できるようになった。





## 感想

よくわからないままやった。ネットワークの勉強は過去にやったけどすべてを忘れているので勉強したい（といって勉強したいものが積まれていく）。