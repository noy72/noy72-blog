---
title: Facebook の Marketing API で取得したアプリインストール数が管理画面と合わない問題
tags: ["広告"]
thumbnail: "https://i.imgur.com/jgh4JkVm.webp"
---

管理画面から取れるデータと API から落とせるデータが一致しなくて困っていた。

https://i.imgur.com/jgh4JkV

解決：`use_unified_attribution_setting`を `true` にした。

## インサイトAPI

facebook に出した広告の効果測定にはインサイト API が使える。

https://developers.facebook.com/docs/marketing-api/insights

この API ではインプレッションや消化金額を取得できる。例えば、日毎 \* 広告毎のデータが欲しい場合は、期間を `time_range` で設定し `time_increment` を1にして、`level` パラメータを `ad` にすれば良い。

データの取得で困ったのが、コンバージョン数（アプリインストール数）をどうやって取るかである。

## インストール数はどこにあるか

インサイト API のフィールドには `impressions` や `clicks`、`conversions` がある。アプリのインストール数が欲しかったので `conversions` をフィールドに追加したがデータが取れなかった。色々試すと `actions` で `list<AdsActionStats>` がとれて、その中に `mobile_app_install` があることに気がついた。

## 値が合わない

`mobile_app_install` で取得できる値と管理画面から見れるアプリインストール数が一致しなかった。インプレッション数などは一致していた。インストール数が一致しない原因はアトリビューション設定によってコンバージョン数の計算の仕方が違うためだと思う。アカウントの設定を揃えたら良いと思って `use_account_attribution_setting` パラメータを `true` にしたが値が一致しなかった。`use_unified_attribution_setting` を true にすると値が一致した。
